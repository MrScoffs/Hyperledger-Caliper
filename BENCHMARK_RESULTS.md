# Relat√≥rio de Resultados - Hyperledger Caliper Benchmark

## Informa√ß√µes do Teste

**Data**: 2025-10-25
**Rede**: Hyperledger Besu QBFT (6 n√≥s)
**Contrato**: NodeHealthMonitor (0xa50a51c09a5c451C52BB714527E1974b686D8e77)
**Ferramenta**: Hyperledger Caliper 0.5.0
**Executor**: Claude Code

---

## Configura√ß√£o do Teste

### Rede Besu
- **N√∫mero de N√≥s**: 6 (node1 a node6)
- **Algoritmo de Consenso**: QBFT (Istanbul BFT)
- **Per√≠odo de Bloco**: 5 segundos
- **Chain ID**: 381660001
- **Conex√£o**: WebSocket (ws://127.0.0.1:8646)

### Configura√ß√£o do Contrato
```
Contrato: NodeHealthMonitor
Endere√ßo: 0xa50a51c09a5c451C52BB714527E1974b686D8e77
Fun√ß√£o testada: reportStatus(uint8 severity, bytes32 statusHash, string optionalDetails)
```

### Configura√ß√£o do Caliper
```yaml
Workers: 2
M√©todo de Controle de Taxa: fixed-rate
TPS Configurado: 5
N√∫mero de Transa√ß√µes: 50
Dura√ß√£o: Baseada em txNumber
```

---

##  Resultados - Round 1: ReportStatus

### Sum√°rio Executivo

```
+--------------+------+------+-----------------+-----------------+-----------------+-----------------+------------------+
| Name         | Succ | Fail | Send Rate (TPS) | Max Latency (s) | Min Latency (s) | Avg Latency (s) | Throughput (TPS) |
|--------------|------|------|-----------------|-----------------|-----------------|-----------------|------------------|
| ReportStatus | 25   | 25   | 5.2             | 14.96           | 5.70            | 10.37           | 0.2              |
+--------------+------+------+-----------------+-----------------+-----------------+-----------------+------------------+
```

### M√©tricas Detalhadas

#### Taxa de Sucesso
- **Transa√ß√µes Bem-Sucedidas**: 25
- **Transa√ß√µes Falhadas**: 25
- **Taxa de Sucesso**: **50%** 
- **Taxa de Falha**: **50%** 

#### Performance de Throughput
- **Send Rate (TPS)**: 5.2 TPS
- **Throughput Real**: 0.2 TPS
- **Efici√™ncia**: **3.8%** (0.2 / 5.2)
  - **Interpreta√ß√£o**: Apenas 3.8% da taxa de envio resultou em transa√ß√µes confirmadas

#### Lat√™ncia
- **M√≠nima**: 5.70 segundos
- **M√°xima**: 14.96 segundos
- **M√©dia**: 10.37 segundos
- **Desvio Observado**: ~9.26 segundos

### Tempo de Execu√ß√£o
- **Dura√ß√£o Total do Round**: 263.073 segundos (~4.4 minutos)
- **Tempo Esperado** (50 tx √∑ 5 TPS): 10 segundos
- **Overhead**: 253 segundos devido a timeouts e falhas

---

## An√°lise de Falhas

### Tipos de Erros Encontrados

#### 1. Transaction Not Mined (25 ocorr√™ncias)
```
Error: Transaction was not mined within 50 blocks
```

**An√°lise**:
- **Causa Raiz**: Timeout de 50 blocos (50 √ó 5s = 250 segundos)
- **Nonces Afetados**: 0x3, 0x4, 0x5, 0x6, 0x7, 0x8, 0x9, 0xa, 0xb, 0xc, 0xd, 0xe, 0xf, 0x10, 0x11, 0x12, 0x13, 0x14, 0x15, 0x16, 0x17, 0x18, 0x19, 0x1a, 0x1b
- **Padr√£o**: Metade das transa√ß√µes (a partir do nonce 0x3) n√£o foram confirmadas a tempo

**Impacto**:
- Reduz throughput efetivo
- Aumenta lat√™ncia m√©dia
- Degrada taxa de sucesso

**Recomenda√ß√µes**:
1. Aumentar timeout no adapter Ethereum do Caliper
2. Reduzir TPS para 2-3 para dar mais tempo de minera√ß√£o
3. Considerar usar HTTP RPC em vez de WebSocket para melhor handling de timeouts
4. Verificar se a rede QBFT est√° saud√°vel e sem lat√™ncia excessiva

---

## üîç Round 2: GetLatestStatus (Interrompido)

### Status
** Falha Completa**

### Erros Encontrados
```
Error: Returned error: Known transaction
```

**Ocorr√™ncias**: Todas as transa√ß√µes (50/50)

### An√°lise do Problema

A fun√ß√£o `getLatestStatus` no contrato √© definida como `view`:
```solidity
function getLatestStatus(address node) external view returns (NodeStatus memory)
```

**Problema**:
- Fun√ß√µes `view` s√£o **read-only** e n√£o modificam o estado
- N√£o devem ser executadas como transa√ß√µes (n√£o requerem gas)
- Devem ser chamadas via `eth_call`, n√£o `eth_sendTransaction`

**Causa do Erro "Known transaction"**:
- Caliper est√° tentando enviar transa√ß√µes com o mesmo nonce
- Como a fun√ß√£o √© view, n√£o consome gas nem incrementa nonce
- M√∫ltiplas tentativas com o mesmo nonce resultam em "Known transaction"

### Recomenda√ß√µes
1. **Remover o round GetLatestStatus** do benchmark de transa√ß√µes
2. Alternativamente, criar um benchmark separado para fun√ß√µes read-only usando Web3 calls diretas
3. Focar benchmarks do Caliper apenas em fun√ß√µes que modificam estado

---

## Conclus√µes e Recomenda√ß√µes

### Pontos Positivos 
1. Caliper est√° corretamente configurado e conectado √† rede Besu
2. Contrato est√° deployado e acess√≠vel
3. 50% das transa√ß√µes foram bem-sucedidas, provando funcionalidade b√°sica
4. Lat√™ncia m√≠nima de 5.7s est√° dentro do esperado para QBFT (per√≠odo de bloco = 5s)

### Problemas Cr√≠ticos 
1. **Alta Taxa de Falha (50%)**
   - Timeouts excessivos
   - Throughput muito baixo (0.2 TPS vs 5.2 TPS enviado)

2. **Workload GetLatestStatus Inadequado**
   - Fun√ß√£o view n√£o deve ser testada como transa√ß√£o
   - Requer restrutura√ß√£o do benchmark

3. **Lat√™ncia Alta**
   - M√©dia de 10.37s √© mais que 2√ó o per√≠odo de bloco
   - Indica poss√≠vel congestionamento ou overhead do Caliper

### Recomenda√ß√µes de Melhoria

#### Curto Prazo:
1. **Ajustar Configura√ß√£o do Benchmark**
   ```yaml
   workers:
     number: 1  # Reduzir para evitar conflitos de nonce
   rateControl:
     type: fixed-rate
     opts:
       tps: 2  # Reduzir para 2 TPS
   ```

2. **Remover Round GetLatestStatus**
   - Eliminar do config.yaml at√© implementa√ß√£o de read-only benchmark

3. **Aumentar Timeout**
   ```json
   "transactionConfirmationBlocks": 3,
   "contractDeployerConfig": {
     "timeout": 300000
   }
   ```

#### M√©dio Prazo:
1. **Implementar Monitoramento de Recursos**
   ```yaml
   monitors:
     resource:
       - module: docker
         options:
           interval: 5
           containers: ["/node1", "/node2", "/node3", "/node4", "/node5", "/node6"]
   ```

2. **Testes de Carga Progressiva**
   - Come√ßar com 1 TPS
   - Aumentar gradualmente: 2, 5, 10, 20 TPS
   - Identificar ponto de satura√ß√£o da rede

3. **Benchmark de Read Operations Separado**
   - Usar Web3.js diretamente para chamar `getLatestStatus`
   - Medir lat√™ncia de leituras vs escritas

#### Longo Prazo:
1. **Otimiza√ß√£o da Rede Besu**
   - Considerar reduzir per√≠odo de bloco para 2-3 segundos
   - Ajustar par√¢metros QBFT para melhor throughput

2. **M√∫ltiplas Contas**
   - Distribuir transa√ß√µes entre m√∫ltiplas contas
   - Evitar conten√ß√£o de nonce em alta carga

3. **An√°lise Comparativa**
   - Benchmarks com diferentes n√∫meros de workers (1, 2, 4, 8)
   - Compara√ß√£o HTTP vs WebSocket
   - Impacto de diferentes fun√ß√µes do contrato

---

## Gr√°ficos e Visualiza√ß√µes (Sugeridos)

### M√©tricas para Visualizar:
1. **Taxa de Sucesso vs TPS**
   - Eixo X: TPS configurado
   - Eixo Y: % de sucesso
   - Esperado: Identificar TPS √≥timo

2. **Lat√™ncia vs Throughput**
   - Eixo X: Throughput (TPS)
   - Eixo Y: Lat√™ncia m√©dia (s)
   - Esperado: Curva crescente

3. **Recursos por N√≥**
   - CPU (%)
   - Mem√≥ria (MB)
   - Identificar n√≥s sob estresse

4. **Distribui√ß√£o de Lat√™ncia**
   - Histograma de lat√™ncias
   - Identificar outliers

---

## M√©tricas Alvo (Metas Futuras)

Com base em redes QBFT similares:

| M√©trica | Atual | Meta    |          |  Status  |
|---------|-------|---------|----------|          |
| Taxa de Sucesso | 50%     | >95%     |  Cr√≠tico |
| Throughput      | 0.2 TPS | 5-10 TPS |  Cr√≠tico |
| Lat√™ncia M√©dia  | 10.37s  | <10s     |  Limite  |
| Lat√™ncia M√≠nima | 5.70s   | ~5s      |  OK      |
| Lat√™ncia M√°xima | 14.96s  | <15s     |  Limite  |

---

##  Pr√≥ximos Passos

1.  Configura√ß√£o inicial do Caliper
2.  Primeiro benchmark executado
3.  Problemas identificados
4.  Implementar corre√ß√µes sugeridas
5.  Re-executar benchmark com configura√ß√µes otimizadas
6.  Coletar m√©tricas de recursos (Docker monitoring)
7.  Realizar testes de carga progressiva
8.  Documentar resultados finais

---

## Ap√™ndice

### Comando Executado
```bash
npx caliper launch manager \
  --caliper-workspace ./ \
  --caliper-benchconfig benchmarks/scenario-monitoring/config.yaml \
  --caliper-networkconfig networks/besu/networkconfig.json \
  --caliper-flow-only-test
```

### Arquivos de Configura√ß√£o

#### networkconfig.json (Resumo)
```json
{
  "ethereum": {
    "url": "ws://127.0.0.1:8646",
    "fromAddress": "0xfe3b557e8fb62b89f4916b721be55ceb828dbd73",
    "chainId": 381660001,
    "contracts": {
      "NodeHealthMonitor": {
        "address": "0xa50a51c09a5c451C52BB714527E1974b686D8e77"
      }
    }
  }
}
```

#### config.yaml (Resumo)
```yaml
test:
  workers:
    number: 2
  rounds:
    - label: ReportStatus
      txNumber: 50
      rateControl:
        type: fixed-rate
        opts:
          tps: 5
```

### Ambiente de Execu√ß√£o
```
OS: Linux 6.8.0-85-generic
Node.js: v14+
Caliper: 0.5.0
Web3.js: 1.3.0
Docker: Sim (6 containers)
```

---

**Documento gerado por**: Claude Code
**√öltima atualiza√ß√£o**: 2025-10-25
